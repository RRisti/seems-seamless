!function(){"use strict";const e=document.querySelector(".grid"),t=t=>e.classList.toggle("__transitioning",t);e.addEventListener("transitionend",(({propertyName:e})=>{"background-size"===e&&t(!1)}));const r=[4,1,2];let n=0;const a=document.querySelector(".informationText");let o="";const i=e=>{o!==a.textContent&&(o=a.textContent),a.textContent=`${e}`},s=e=>+e.toFixed(2),d=(e,t)=>Math.floor(e/t+1)*t,c=(e,t)=>Math.ceil(e/t-1)*t,l="--transition-duration",u="dragenter",g="dragleave",h="drop",p=".cell";let f,m=!1,w=100;const v=e=>document.querySelector(e),L=(e,t)=>document.addEventListener(e,t),E=v("body"),b=(e,t)=>E.style.setProperty(e,t),$=new Image;let x=0,y=0;const D=e=>{e.stopPropagation(),e.preventDefault()},A=document.createElement("canvas"),M=A.getContext("2d"),R=new DOMParser,U=v('input[type="file"]'),k=v("#repeatInput"),S=v("#zoomInput"),j=[...document.querySelectorAll(p)],q=(t=null)=>{const r="data-active",n="__active";if(e.removeAttribute(r),t){if(t.classList.includes(n))return t.classList.remove(n);const a=[...t.parentElement.children].indexOf(t);e.setAttribute(r,`${a+1}`)}j.forEach((e=>{e.classList.toggle(n,e===t)}))},O=()=>{const e=s(w/100),t=t=>Math.floor(e*t);i(`${w.toFixed(2)}% | ${t(x)} x ${t(y)}`)},F=e=>{w=Math.min(250,Math.max(10,+e)),S.value=`${e}`,b("--zoom-level",`${s(w/100)}`),O()},I=({row:e,column:t},r)=>{M.drawImage($,t*x,e*y,x,y,0,0,x,y),A.toBlob((e=>{j[r].style.backgroundImage=`url(${URL.createObjectURL(e)})`}))},T=()=>{(({height:e,width:t})=>{y=e,x=t,Object.assign(A,{width:t,height:e}),b("--background-width",`${t}px`)})({height:$.naturalHeight/2,width:$.naturalWidth/2}),[[0,0],[0,1],[1,0],[1,1]].map((([e,t])=>({row:e,column:t}))).forEach(I),m=!0,S.disabled=!1,F(37.5*Math.min(window.innerWidth/x,window.innerHeight/y))},C=(e=0)=>i(`Loading image ${e.toFixed(0)}%...`),P=e=>{const t=(e=>{if(e)try{const t=new URL(e),{host:r,searchParams:n}=t;return["cdn.discordapp.com","media.discordapp.net"].includes(r)&&(n.delete("width"),n.delete("height")),`${t}`}catch(e){console.error(e)}})(e);if(!t||t===f)return;f=t;const r=new XMLHttpRequest;return r.responseType="arraybuffer",r.open("GET",t,!0),r.addEventListener("loadstart",(()=>C())),r.addEventListener("progress",(({loaded:e,total:t})=>C(e/t*100))),r.addEventListener("error",(()=>i("Error loading image"))),r.addEventListener("load",(e=>{const t=new Blob([e.target.response]);$.addEventListener("load",T,{once:!0}),$.src=window.URL.createObjectURL(t),q()})),r.send(),r},_=e=>P((e=>{if(!e)return;const t=R.parseFromString(e,"text/html");for(let[e,r="href"]of[["img","src"],['a[href$=".png"]',"href"],['a[href$=".jpg"]',"href"],['a[href$=".jpeg"]',"href"],['a[href$=".webp"]',"href"]]){const n=t.querySelector(e)?.getAttribute(r);if(n)return n}})(e)),z=e=>{const t=[...e.files].find((({type:e})=>e.startsWith("image/")));if(t){f=null;let e=new FileReader;e.readAsDataURL(t),e.addEventListener("loadend",(()=>{$.addEventListener("load",T,{once:!0}),$.src=`${e.result}`,q()}))}const r=e.getData?.("text/html");if(r)return _(r);const n=e.getData?.("text");return n?(e=>{const t=e?.split(/\s+/).find((e=>/^https?:\/\//.test(e)&&/\.(jpe?g|png|webp)$/.test(e)));if(t)return P(t)})(n):void 0};L("wheel",(e=>{m&&F(s(w-e.deltaY/20))})),S.addEventListener("input",(({target:e})=>F(e.value))),["dragover",u,g,h].forEach((e=>{E.addEventListener(e,(t=>{if(D(t),e===u&&i("Load"),e===g&&i(o),e===h)return z(t.dataTransfer),O(),!1}))})),L("keyup",(({code:e})=>{if(m)if("ArrowUp"!==e&&"ArrowDown"!==e){if("Space"===e)return b(l,"0ms"),E.dataset.columns=`${r[n++%r.length]}`,void setTimeout((()=>b(l,null)),10);(e=>{const t=j[e];t&&q(t)})(["Digit1","Digit2","Digit3","Digit4"].indexOf(e))}else{t(!0);F(("ArrowUp"===e?d:c)(w,20))}})),L("click",(({target:e})=>{m&&e.matches(p)&&q(e)})),L("paste",(e=>z(e.clipboardData))),U.addEventListener("change",(e=>{D(e),z(e.target)})),k.addEventListener("change",(e=>{b("--background-repeat",e.target.checked?"no-repeat":"repeat")}))}();
